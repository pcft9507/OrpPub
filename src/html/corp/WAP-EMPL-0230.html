@@include('./head.html', {title: ""})
<body>
  <div class="wrap">

    @@include('./header.html')
    
    <!-- container -->
    <div class="container">
      @@include('./snb.html', {type: "기업담당자", dep1: "3"})

      <div class="contents-header">
        <div class="contents-header__title-cell">
          <h2 class="contents-header--title">[ORP연구소] 2021년 하반기 인턴 채용</h2>
          <div class="cell">
            <div class="dropdown" style="width: 128px;">
              <button type="button" class="dropdown-btn type3"
                data-dropdown='{
                  "name": "headerDropdown",
                  "type" : "single",
                  "option": [
                    {
                      "name": "사무",
                      "value": "사무",
                      "disabled": false,
                      "checked": true
                    },
                    {
                      "name": "옵션2",
                      "value": "옵션2",
                      "disabled": false,
                      "checked": false
                    }
                  ]
                }'
              >선택하세요</button>
              <script>
                dropdown.init('dropdown', {
                  name: 'headerDropdown',
                  onChange: _this=>{
                    console.log(_this.value);
                  }
                });
              </script>
            </div>
          </div>
          <div class="cell">
            <div class="dropdown" style="width: 128px;">
              <button type="button" class="dropdown-btn type3"
                data-dropdown='{
                  "name": "headerDropdown2",
                  "type" : "single",
                  "option": [
                    {
                      "name": "서류전형",
                      "value": "서류전형",
                      "disabled": false,
                      "checked": false
                    },
                    {
                      "name": "옵션2",
                      "value": "옵션2",
                      "disabled": false,
                      "checked": false
                    }
                  ]
                }'
              >선택하세요</button>
              <script>
                dropdown.init('dropdown', {
                  name: 'headerDropdown2',
                  onChange: _this=>{
                    console.log(_this.value);
                  }
                });
              </script>
            </div>
          </div>
        </div>
        <div class="contents-header__btns">
          <a href="#" class="btn">
            <span class="base-icon icon-folder__size-m__color5">전형관리</span>
          </a>
          <a href="#" class="btn">
            <span class="base-icon icon-trophy__size-m__color5">합격자 발표</span>
          </a>
          <a href="#" class="btn">
            <span class="base-icon icon-graph__size-m__color5">통계</span>
          </a>
        </div>
      </div>

      <!-- contents navigation -->
      <div class="contents-nav type2">
        <div class="contents-nav__inner">
          <div class="contents-nav__btn-box">
            <button type="button" class="base-btn type2__size-m">초기화</button>
          </div>
          <div class="contents-nav__btn-box">
            <button type="button" class="base-btn type2__size-m">취소</button>
            <button type="button" class="base-btn type1__size-m">저장</button>
          </div>
        </div>
      </div>
      <!-- //contents navigation -->

      <!-- contents -->
      <div class="contents">

        <h3 class="title-sub">평가설정</h3>

        <div class="base-tab tab-type1 content-mt6" data-ref="tabContents1">
          <ul class="tab__list" role="tablist">
            <li class="tab__item">
              <button role="tab" aria-selected="false">적부평가</button>
            </li>
            <li class="tab__item">
              <button role="tab" aria-selected="false">정량평가</button>
            </li>
            <li class="tab__item">
              <button role="tab" aria-selected="true">정성평가</button>
            </li>
          </ul>
        </div>
        <script>
          const tabContents1 = new TabContents({target: 'tabContents1'});
        </script>

        <div class="base-tab tab-type2 content-mt3" data-ref="tabContents2">
          <ul class="tab__list" role="tablist">
            <li class="tab__item">
              <button role="tab" aria-selected="false">평가요소</button>
            </li>
            <li class="tab__item">
              <button role="tab" aria-selected="true">평가자</button>
            </li>
            <li class="tab__item">
              <button role="tab" aria-selected="false">집계기준</button>
            </li>
            <li class="tab__item">
              <button role="tab" aria-selected="false">등급</button>
            </li>
            <li class="tab__item">
              <button role="tab" aria-selected="false">평가시스템 설정</button>
            </li>
          </ul>
        </div>
        <script>
          const tabContents2 = new TabContents({target: 'tabContents2'});
        </script>

        <div class="box-type1 content-mt6">
          <div class="board-body">
            <div id="table" class="table table-type1" style="width:100%;overflow-x: auto;">
              <table class="type-line">
                <colgroup>
                  <col style="width:230px;">
                  <col style="width:180px;">
                  <col style="width:180px;">
                  <col>
                  <col>
                  <col>
                  <col>
                </colgroup>
                <thead>
                  <tr>
                    <th>평가자</th>
                    <th>ID</th>
                    <th>평가요소</th>
                    <th>
                      1실
                      <button onclick="deleteColumn(this);">
                        <span class="base-icon icon-trash__size-m__color3" >
                          <span class="isHidden">삭제</span>
                        </span>
                      </button>
                    </th>
                    <th>
                      2실
                      <button onclick="deleteColumn(this);">
                        <span class="base-icon icon-trash__size-m__color3">
                          <span class="isHidden">삭제</span>
                        </span>
                      </button>
                    </th>
                    <th>
                      3실
                      <button onclick="deleteColumn(this);">
                        <span class="base-icon icon-trash__size-m__color3">
                          <span class="isHidden">삭제</span>
                        </span>
                      </button>
                    </th>
                    <th><button class="base-icon icon-add__size-s__color3 point-color5">실추가</button></th>
                  </tr>
                </thead>
                <tbody class="first-td-bdt0">
                  <tr>
                    <td class="pd-type1">
                      <div class="form-inner type-gap2">
                        <button type="button" class="btn-item--del" onclick="rowItemDel(5);">
                          <span>삭제</span>
                        </button>
                        <div class="sch-comp sch-comp1 h-full">
                          <div class="sch-comp__in">
                            <div class="sch-comp__inp-wrap">
                              <!-- D:선택이지만 선택 리스트의 검색은 텍스트로 -->
                              <div class="sch-comp__inp" data-type="search-select" style="display:block!important;">
                                <button class="sch-comp__ss-btn search-btn">검색</button>
                                <div class="sch-comp__ss">
                                  <div class="input-box type-search">
                                    <input type="text" class="input-txt" placeholder="어학시험 검색" oninput="inputValueChk()">
                                    <button type="button" class="btn-del" onclick="inputValueDel()">키워드 삭제</button>
                                  </div>
                                  <div class="sch-comp__ss-result">
                                    <ul class="sch-comp__result-list">
                                      <li><a href="#" class="sch-comp__btn-result selected"data-licenseCd="license1" data-licenseNm="a-12345" data-addColumn="" data-licenseTable="table1" data-def="case1">OPIC1</a></li>
                                      <li><a href="#" class="sch-comp__btn-result selected"data-licenseCd="license1" data-licenseNm="a-12345" data-addColumn="" data-licenseTable="table1" data-def="case1">OPIC2</a></li>
                                      <li><a href="#" class="sch-comp__btn-result"data-licenseCd="license1" data-licenseNm="a-12345" data-addColumn="" data-licenseTable="table1" data-def="case2">TOEIC</a></li>
                                      <li><a href="#" class="sch-comp__btn-result"data-licenseCd="license1" data-licenseNm="a-12345" data-addColumn="" data-licenseTable="table1" data-def="case2">TOEIC2</a></li>
                                      <li><a href="#" class="sch-comp__btn-result"data-licenseCd="license1" data-licenseNm="a-12345" data-addColumn="" data-licenseTable="table1" data-def="case3">TOEIC3</a></li>
                                      <li><a href="#" class="sch-comp__btn-result"data-licenseCd="license1" data-licenseNm="a-12345" data-addColumn="" data-licenseTable="table1" data-def="case3">TOEIC4</a></li>
                                      <li><a href="#" class="sch-comp__btn-result"data-licenseCd="license1" data-licenseNm="a-12345" data-addColumn="" data-licenseTable="table1"  data-def="case3">TOEIC5</a></li>
                                    </ul>
                                  </div>
                                </div>
                              </div>
                              <!-- // D:선택이지만 선택 리스트의 검색은 텍스트로 -->
                            </div>
                          </div>

                          <div class="search-tag content-mt2" id="searchTag">
                            <div class="tag__box" data-licenseTable="table1">
                              <div class="tag__item tag__item--type1"><span class="txt">OPIC1</span><button type="button" class="del"></button></div>
                              <div class="tag__item tag__item--type1"><span class="txt">OPIC2</span><button type="button" class="del"></button></div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </td>
                    <td>bokyoung_kim@orp</td>
                    <td>
                      <div class="flex-col">
                        <label class="input-chk">
                          <input type="checkbox" value="chkAll" data-ref="chkItem" onchange="inputCheckAll('chkItem')">
                          <span>지원동기</span>
                        </label>
                        <label class="input-chk">
                          <input type="checkbox" value="chkAll" data-ref="chkItem" onchange="inputCheckAll('chkItem')">
                          <span>직무동기성</span>
                        </label>
                        <label class="input-chk">
                          <input type="checkbox" value="chkAll" data-ref="chkItem" onchange="inputCheckAll('chkItem')">
                          <span>조작적합성</span>
                        </label>
                      </div>
                    </td>
                    <td>
                      <label class="input-chk">
                        <input type="checkbox">
                        <span class="isHidden">선택</span>
                      </label>
                    </td>
                    <td>
                      <label class="input-chk">
                        <input type="checkbox">
                        <span class="isHidden">선택</span>
                      </label>
                    </td>
                    <td>
                      <label class="input-chk">
                        <input type="checkbox">
                        <span class="isHidden">선택</span>
                      </label>
                    </td>
                    <td></td>
                  </tr>
                </tbody>
              </table>

              <div class="form-inner content-mt2 pd-type1">
                <button type="button" class="btn-item--add" onclick="addRow();">
                  <span>추가</span>
                </button>
              </div>
            </div>
          </div>          
        </div>
      </div>
      <!-- //contents -->
    </div>
    <!-- //container -->
    
  </div>
<script>
  // 실추가
  document.addEventListener('DOMContentLoaded', function() {
    const addButton = document.querySelector('.icon-add__size-s__color3');
    
    addButton.addEventListener('click', function() {
      const theadRow = document.querySelector('.type-line thead tr');
      const tbodyRows = document.querySelectorAll('.type-line tbody tr');
      const existingCols = theadRow.querySelectorAll('th').length;
      
      // 최대 칼럼 수를 10으로 제한
      if(existingCols - 1 > 11) { // 첫 번째 '평가자'와 'ID' 칼럼을 제외한 순수한 '실' 칼럼만 계산
        alert('최대 10실까지만 추가 가능합니다.');
        return;
      }
      
      const newColIndex = existingCols - 3; // '실추가' 버튼 칼럼을 제외한 새 칼럼의 인덱스
      const newTh = document.createElement('th');
      newTh.innerHTML = `${newColIndex}실
                          <button type="button" onclick="deleteColumn(this);">
                            <span class="base-icon icon-trash__size-m__color3">
                              <span class="isHidden">삭제</span>
                            </span>
                          </button>`;
      
      // '실추가' 버튼의 th 요소를 찾아 그 전에 새로운 th 요소 삽입
      const addButtonTh = addButton.closest('th');
      theadRow.insertBefore(newTh, addButtonTh);
      
      // tbody의 각 행에 새로운 td 요소 추가
      tbodyRows.forEach(row => {
        const newTd = document.createElement('td');
        newTd.innerHTML = `<label class="input-chk">
                              <input type="checkbox">
                              <span class="isHidden">선택</span>
                            </label>`;
        // 마지막 td 요소 전에 새로운 td 요소 삽입
        const lastTd = row.querySelectorAll('td')[newColIndex-2]; // 새로운 칼럼을 '실추가' 버튼 전의 칼럼 위치에 삽입
        row.insertBefore(newTd, lastTd ? lastTd.nextSibling : null);
      });
    });
  });

  // 행추가'addRow' 함수 정의
  function addRow() {
    // thead에서 칼럼의 수를 계산
    const columnCount = document.querySelector("#table .type-line thead tr").childElementCount;
    
    // 기본 템플릿을 시작
    let template = `
      <tr>
        <td class="pd-type1">
          <div class="form-inner type-gap2">
            <button type="button" class="btn-item--del" onclick="rowItemDel(5);"><span>삭제</span></button>
            <div class="sch-comp sch-comp1 h-full">
              <div class="sch-comp__in">
                <div class="sch-comp__inp-wrap">
                  <!-- D:선택이지만 선택 리스트의 검색은 텍스트로 -->
                  <div class="sch-comp__inp" data-type="search-select" style="display:block!important;">
                    <button class="sch-comp__ss-btn search-btn">검색</button>
                    <div class="sch-comp__ss">
                      <div class="input-box type-search">
                        <input type="text" class="input-txt" placeholder="어학시험 검색" oninput="inputValueChk()">
                        <button type="button" class="btn-del" onclick="inputValueDel()">키워드 삭제</button>
                      </div>
                      <div class="sch-comp__ss-result">
                        <ul class="sch-comp__result-list">
                          <li><a href="#" class="sch-comp__btn-result" ></a></li>
                        </ul>
                      </div>
                    </div>
                  </div>
                  <!-- // D:선택이지만 선택 리스트의 검색은 텍스트로 -->
                </div>
              </div>

              <div class="search-tag content-mt2" id="searchTag">
                <div class="tag__box" data-licenseTable="table1">
                  <div class="tag__item tag__item--type1"><span class="txt"></span><button type="button" class="del"></button></div>
                  <div class="tag__item tag__item--type1"><span class="txt"></span><button type="button" class="del"></button></div>
                </div>
              </div>
            </div>
          </div>
        </td>
    `;

    template += `<td>bokyoung_kim@orp</td>`;
    // ID 칼럼
    template += `
            <td>
          <div class="flex-col">
            <label class="input-chk">
              <input type="checkbox" value="chkAll" data-ref="chkItem" onchange="inputCheckAll('chkItem')">
              <span>지원동기</span>
            </label>
            <label class="input-chk">
              <input type="checkbox" value="chkAll" data-ref="chkItem" onchange="inputCheckAll('chkItem')">
              <span>직무동기성</span>
            </label>
            <label class="input-chk">
              <input type="checkbox" value="chkAll" data-ref="chkItem" onchange="inputCheckAll('chkItem')">
              <span>조작적합성</span>
            </label>
          </div>
        </td>
    `;


    // 나머지 칼럼에 대해서는 체크박스를 추가합니다.
    for (let i = 3; i < columnCount - 1; i++) { // 평가자, ID 칼럼을 제외하고 시작
      template += `
        <td>
          <label class="input-chk">
            <input type="checkbox">
            <span class="isHidden">선택</span>
          </label>
        </td>`;
    }

    
    // 템플릿을 마무리하고 빈 td 추가(마지막 실추가 버튼 칼럼에 대응)
    template += '<td></td></tr>';
    
    // 'table' 요소 내의 'tbody'를 찾아 완성된 'template'을 추가
    const tbody = document.querySelector("#table table tbody");
    tbody.insertAdjacentHTML('beforeend', template);
  }

  function deleteColumn(element) {
    const theadRow = element.closest('table').querySelector('thead tr');
    const colCount = theadRow.querySelectorAll('th').length;
    
    // 최소 3개의 칼럼이 유지되어야 함을 확인
    if(colCount <= 6) { // '평가자', 'ID', 그리고 최소 1개의 '실' 칼럼을 포함하여 총 3개가 기본적으로 있어야 함
      alert('기본값은 3실입니다.');
      return; // 함수 실행을 여기서 중단
    }
    
    // 클릭된 버튼이 속한 th 요소의 인덱스를 찾음
    const thIndex = element.closest('th').cellIndex;
    
    // thead 내에서 해당 th 요소 삭제
    element.closest('table').querySelector('thead tr').deleteCell(thIndex);
    
    // tbody 내의 모든 행을 순회하면서 동일한 인덱스의 td 요소 삭제
    document.querySelectorAll("#table .type-line tbody tr").forEach(row => {
      if(row.cells.length > thIndex) { // 해당 인덱스에 td 요소가 존재하는 경우만 삭제
        row.deleteCell(thIndex);
      }
    });
    
    // colgroup 내에서 해당 인덱스의 <col> 요소 삭제
    const colgroup = document.querySelector("#table colgroup");
    if(colgroup && colgroup.children[thIndex]) {
      colgroup.removeChild(colgroup.children[thIndex]);
    }
  }

  function addColumn() {
    // 새로운 <col> 요소 생성
    const newCol = document.createElement('col');

    // colgroup에 새로운 <col> 요소 추가
    document.querySelector("#table colgroup").appendChild(newCol);
  }

  document.addEventListener('DOMContentLoaded', function() {
    // 'thead'에 이벤트 리스너를 추가하여 '실 삭제' 버튼 클릭 이벤트를 위임합니다.
    document.querySelector('#table thead').addEventListener('click', function(event) {
      // 클릭된 요소가 '실 삭제' 버튼인지 확인합니다.
      if (event.target.closest('.delete-column')) {
        const element = event.target.closest('.delete-column');
        deleteColumn(element);
      }
    });
  });

  /* 텍스트 자동 입력 */

</script>
</body>
</html>