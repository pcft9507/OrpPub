@@include('./head.html', {title: ""})
<body>
  <div class="wrap">

    @@include('./header.html')
    
    <!-- container -->
    <div class="container">
      @@include('./snb.html', {type: "기업담당자", dep1: "3"})

      <div class="contents-header">
        <div class="contents-header__title-cell">
          <h2 class="contents-header--title">[ORP연구소] 2021년 하반기 인턴 채용</h2>
          <div class="cell">
            <div class="dropdown" style="width: 128px;">
              <button type="button" class="dropdown-btn type3"
                data-dropdown='{
                  "name": "headerDropdown",
                  "type" : "single",
                  "option": [
                    {
                      "name": "사무",
                      "value": "사무",
                      "disabled": false,
                      "checked": true
                    },
                    {
                      "name": "옵션2",
                      "value": "옵션2",
                      "disabled": false,
                      "checked": false
                    }
                  ]
                }'
              >선택하세요</button>
              <script>
                dropdown.init('dropdown', {
                  name: 'headerDropdown',
                  onChange: _this=>{
                    console.log(_this.value);
                  }
                });
              </script>
            </div>
          </div>
          <div class="cell">
            <div class="dropdown" style="width: 128px;">
              <button type="button" class="dropdown-btn type3"
                data-dropdown='{
                  "name": "headerDropdown2",
                  "type" : "single",
                  "option": [
                    {
                      "name": "서류전형",
                      "value": "서류전형",
                      "disabled": false,
                      "checked": true
                    },
                    {
                      "name": "옵션2",
                      "value": "옵션2",
                      "disabled": false,
                      "checked": false
                    }
                  ]
                }'
              >선택하세요</button>
              <script>
                dropdown.init('dropdown', {
                  name: 'headerDropdown2',
                  onChange: _this=>{
                    console.log(_this.value);
                  }
                });
              </script>
            </div>
          </div>
        </div>
        <div class="contents-header__btns">
          <a href="#" class="btn">
            <span class="base-icon icon-folder__size-m__color5">전형관리</span>
          </a>
          <a href="#" class="btn">
            <span class="base-icon icon-trophy__size-m__color5">합격자 발표</span>
          </a>
          <a href="#" class="btn">
            <span class="base-icon icon-graph__size-m__color5">통계</span>
          </a>
        </div>
      </div>

      <!-- contents navigation -->
      <div class="contents-nav type2">
        <div class="contents-nav__inner">
          <div class="contents-nav__btn-box"></div>
          <div class="contents-nav__btn-box">
            <button type="button" class="base-btn type2__size-m">취소</button>
            <button type="button" class="base-btn type1__size-m">저장</button>
          </div>
        </div>
      </div>
      <!-- //contents navigation -->

      <!-- contents -->
      <div class="contents">
        <h3 class="title-sub">평가설정</h3>

        <div class="base-tab tab-type1" data-ref="tabContents1">
          <ul class="tab__list" role="tablist">
            <li class="tab__item">
              <button role="tab" aria-selected="false">면접정보</button>
            </li>
            <li class="tab__item">
              <button role="tab" aria-selected="true">평가요소</button>
            </li>
            <li class="tab__item">
              <button role="tab" aria-selected="false">평가자</button>
            </li>
            <li class="tab__item">
              <button role="tab" aria-selected="false">집계기준</button>
            </li>
            <li class="tab__item">
              <button role="tab" aria-selected="false">등급</button>
            </li>
            <li class="tab__item">
              <button role="tab" aria-selected="false">평가시스템 설정</button>
            </li>
          </ul>
        </div>
        <script>
          const tabContents1 = new TabContents({target: 'tabContents1'});
        </script>

        <div class="box-type5 content-mt3">
          <div class="d-flex ai-c jc-sb">
            <span class="point-color6">평가요소를 직접 등록할 수 있습니다.</span>

            <button type="button" class="base-btn type2__size-s" onclick="controlWrap.add();">
              <span class="base-icon icon-down__size-s__color1">불러오기</span>
            </button>
          </div>
        </div>

        <div class="section-type1">
          <div class="section-cont-wrap">
            <div class="section-cont" data-index="1">
              <div class="d-flex jc-sb content-mt5">
                <h4 class="title-sub1">평가요소1</h4>
              
                <div class="form-set__btn type-gap2">
                  <button type="button" onclick="rowItemDown('.section-type1 .section-cont');">
                    <span class="base-icon icon-down2__size-m__color3">
                      <span class="isHidden">아래로</span>
                    </span>
                  </button>
                  <button type="button" onclick="rowItemUp('.section-type1 .section-cont');">
                    <span class="base-icon icon-up__size-m__color3">
                      <span class="isHidden">위로</span>
                    </span>
                  </button>
                  <button type="button" class="base-btn type-icon__color1" onclick="sectionItemDel('.section-type1 .section-cont');">
                    <span class="base-icon icon-del__size-s__color3">
                      <strong class="font-size-l">삭제</strong>
                    </span>
                  </button>
                </div>          
              </div>
              
              <div class="box-type1">
                <div class="form-row__flex">
                  <div class="form-th" style="width: 240px;">평가요소명</div>
                  <div class="form-td" style="flex: 1;">
                    <div class="form-inner">
                      <div class="input-box h-full">
                        <input type="text" class="input-txt" oninput="inputValueChk()" value="지원동기">
                        <button type="button" class="btn-del" onclick="inputValueDel()">입력 삭제</button>
                      </div>
                    </div>
                  </div>
                </div>            
                <div class="form-row__flex">
                  <div class="form-th" style="width: 240px;">평가요소정의</div>
                  <div class="form-td" style="flex: 1;">
                    <div class="form-inner">
                      <div class="input-box h-full">
                        <input type="text" class="input-txt" oninput="inputValueChk()" placeholder="입력하세요">
                        <button type="button" class="btn-del" onclick="inputValueDel()">입력 삭제</button>
                      </div>
                    </div>
                  </div>
                </div>            
                <div class="form-row__flex">
                  <div class="form-th" style="width: 240px;">하위요소</div>
                  <div class="form-td" style="flex: 1;">
                    <div class="form-inner">
                      <button type="button" class="btn-item--del" onclick="rowItemDel();">
                        <span>삭제</span>
                      </button>
                      <div class="input-box" style="width: 200px;">
                        <input type="text" class="input-txt" placeholder="하위요소명" oninput="inputValueChk()">
                        <button type="button" class="btn-del" onclick="inputValueDel()">입력 삭제</button>
                      </div>
                      <div class="input-box" style="flex: 1;">
                        <input type="text" class="input-txt" placeholder="하위요소설명" value="ORP 연구소와 지원분야에 지원한 동기가 분명하게 작성되어 있다" oninput="inputValueChk()">
                        <button type="button" class="btn-del" onclick="inputValueDel()">입력 삭제</button>
                      </div>
                    </div>
                    <div class="form-inner">
                      <button type="button" class="btn-item--add" onclick="rowItemAdd();">
                        <span>추가하기</span>
                      </button>
                    </div>
                  </div>
                </div>   
                <div class="form-row__flex">
                  <div class="form-th" style="width: 240px;">면접과제</div>
                  <div class="form-td" style="flex: 1;">
                    <div class="form-inner">
                      <button type="button" class="base-btn type2__size-s">
                        <span class="base-icon icon-upload__size-s__color1" onclick="document.getElementById('uploadFile1').click();">파일업로드</span>
                      </button>
                      <input type="file" id="uploadFile1" class="is-hidden" title="파일업로드" onchange="addFileName(this)">
                    </div>
                    <div class="form-inner">
                      <div class="tag__box"></div>
                    </div>
                  </div>
                </div>            
              </div>
            </div>
          </div>

          <div class="btn-wrap d-flex jc-fe content-mt4">
            <button type="button" class="btn-item--add" onclick="addSectionType1Cont();">
              <span>평가요소 추가</span>
            </button>
          </div>
        </div>

        <div class="section-type2">
          <div class="section-cont-wrap">
            <div class="section-cont" data-index="1">
              <div class="d-flex jc-sb content-mt5">
                <h4 class="title-sub1">질문지1</h4>
                <div class="form-set__btn type-gap2">
                  <button type="button" onclick="rowItemDown('.section-type2 .section-cont');">
                    <span class="base-icon icon-down2__size-m__color3">
                      <span class="isHidden">아래로</span>
                    </span>
                  </button>
                  <button type="button" onclick="rowItemUp('.section-type2 .section-cont');">
                    <span class="base-icon icon-up__size-m__color3">
                      <span class="isHidden">위로</span>
                    </span>
                  </button>
                  <button type="button" class="base-btn type-icon__color1" onclick="sectionItemDel('.section-type2 .section-cont');">
                    <span class="base-icon icon-del__size-s__color3">
                      <strong class="font-size-l">삭제</strong>
                    </span>
                  </button>
                </div>          
              </div>
              
              <div class="box-type1">
                <div class="form-row__flex">
                  <div class="form-th" style="width: 240px;">질문주제</div>
                  <div class="form-td" style="flex: 1;">
                    <div class="form-inner">
                      <div class="input-box h-full">
                        <input type="text" class="input-txt" oninput="inputValueChk()" value="지원동기">
                        <button type="button" class="btn-del" onclick="inputValueDel()">입력 삭제</button>
                      </div>
                    </div>
                  </div>
                </div>            
                <div class="form-row__flex">
                  <div class="form-th" style="width: 240px;">주질문</div>
                  <div class="form-td" style="flex: 1;">
                    <div class="form-inner">
                      <button type="button" class="btn-item--del" onclick="rowItemDel();">
                        <span>삭제</span>
                      </button>
                      <div class="input-box" style="width: 200px;">
                        <input type="text" class="input-txt" placeholder="주질문 입력" oninput="inputValueChk()">
                        <button type="button" class="btn-del" onclick="inputValueDel()">입력 삭제</button>
                      </div>
                      <div class="input-box" style="flex: 1;">
                        <input type="text" class="input-txt" placeholder="주질문 설명 입력" oninput="inputValueChk()">
                        <button type="button" class="btn-del" onclick="inputValueDel()">입력 삭제</button>
                      </div>
                    </div>
                    <div class="form-inner">
                      <button type="button" class="btn-item--add" onclick="rowItemAdd(14);">
                        <span>추가하기</span>
                      </button>
                    </div>
                  </div>
                </div>   
                <div class="form-row__flex">
                  <div class="form-th" style="width: 240px;">추가질문</div>
                  <div class="form-td" style="flex: 1;">
                    <div class="form-inner">
                      <button type="button" class="btn-item--del" onclick="rowItemDel();">
                        <span>삭제</span>
                      </button>
                      <div class="input-box" style="width: 200px;">
                        <input type="text" class="input-txt" placeholder="추가질문 입력" oninput="inputValueChk()">
                        <button type="button" class="btn-del" onclick="inputValueDel()">입력 삭제</button>
                      </div>
                      <div class="input-box" style="flex: 1;">
                        <input type="text" class="input-txt" placeholder="추가질문 설명 입력" oninput="inputValueChk()">
                        <button type="button" class="btn-del" onclick="inputValueDel()">입력 삭제</button>
                      </div>
                    </div>
                    <div class="form-inner">
                      <button type="button" class="btn-item--add" onclick="rowItemAdd(15);">
                        <span>추가질문 추가</span>
                      </button>
                    </div>
                  </div>
                </div>   
              </div>
            </div>
          </div>

          <div class="btn-wrap d-flex jc-fe content-mt4">
            <button type="button" class="btn-item--add" onclick="addSectionType2Cont();">
              <span>질문지 추가</span>
            </button>
          </div>
        </div>
      </div>
      <!-- //contents -->
    </div>
    <!-- //container -->

    @@include('../html/corp/WAP-EMPL-0351.html');
    @@include('../html/corp/WAP-EMPL-0352.html');
  </div>
<script>
  const pop = {
    "WAP_EMPL_0351" : ()=>{WAP_EMPL_0351.show()},
    "WAP_EMPL_0352" : ()=>{WAP_EMPL_0352.show()}
  }
  if(Util.getUrlParams().popup) pop[Util.getUrlParams().popup]();

  // 평가요소
  const controlWrap1 = new ControlAddItem({
    target: 'tabContents1'
  });
 function addFileName(input) {
    if (input.files && input.files[0]) {
      var fileName = input.files[0].name; // 파일 이름 추출
      
      // 태그 아이템 템플릿 생성
      var tagItem = document.createElement('div');
      tagItem.className = 'tag__item tag__item--type1 no-mw';
      tagItem.innerHTML = `
        <span class="txt">${fileName}</span>
        <button type="button" class="del" onclick="removeTagItem(this)">삭제</button>
        <button type="button" class="print">인쇄</button>
      `;
      
      // tag__box 내부에 생성된 태그 아이템 추가
      //document.querySelector('.tag__box').appendChild(tagItem);
      const currentTarget = event.target.closest('.section-cont').querySelector('.tag__box').appendChild(tagItem);
    }
  }

  // 태그 아이템 삭제 함수
  function removeTagItem(button) {
    button.parentElement.remove();
  }

  // 평가요소 추가
  function addSectionType1Cont() {
    const sectionType1 = document.querySelector('.section-type1');
    const section1ContWrap = document.querySelector('.section-type1 .section-cont-wrap');
    const index = document.querySelectorAll('.section-type1 .section-cont').length + 1; // 새로운 인덱스 계산

    // 평가요소 템플릿
    const template = `
      <div class="section-cont" data-index="${index}">
        <div class="d-flex jc-sb content-mt5">
          <h4 class="title-sub1">평가요소${index}</h4>
        
          <div class="form-set__btn type-gap2">
            <button type="button" onclick="rowItemDown('.section-type1 .section-cont');">
              <span class="base-icon icon-down2__size-m__color3">
                <span class="isHidden">아래로</span>
              </span>
            </button>
            <button type="button" onclick="rowItemUp('.section-type1 .section-cont');">
              <span class="base-icon icon-up__size-m__color3">
                <span class="isHidden">위로</span>
              </span>
            </button>
            <button type="button" class="base-btn type-icon__color1" onclick="sectionItemDel('.section-type1 .section-cont');">
              <span class="base-icon icon-del__size-s__color3">
                <strong class="font-size-l">삭제</strong>
              </span>
            </button>
          </div>          
        </div>
        
        <div class="box-type1">
          <div class="form-row__flex">
            <div class="form-th" style="width: 240px;">평가요소명</div>
            <div class="form-td" style="flex: 1;">
              <div class="form-inner">
                <div class="input-box h-full">
                  <input type="text" class="input-txt" oninput="inputValueChk()" value="지원동기">
                  <button type="button" class="btn-del" onclick="inputValueDel()">입력 삭제</button>
                </div>
              </div>
            </div>
          </div>            
          <div class="form-row__flex">
            <div class="form-th" style="width: 240px;">평가요소정의</div>
            <div class="form-td" style="flex: 1;">
              <div class="form-inner">
                <div class="input-box h-full">
                  <input type="text" class="input-txt" oninput="inputValueChk()" placeholder="입력하세요">
                  <button type="button" class="btn-del" onclick="inputValueDel()">입력 삭제</button>
                </div>
              </div>
            </div>
          </div>            
          <div class="form-row__flex">
            <div class="form-th" style="width: 240px;">하위요소</div>
            <div class="form-td" style="flex: 1;">
              <div class="form-inner">
                <button type="button" class="btn-item--del" onclick="rowItemDel();">
                  <span>삭제</span>
                </button>
                <div class="input-box" style="width: 200px;">
                  <input type="text" class="input-txt" placeholder="하위요소명" oninput="inputValueChk()">
                  <button type="button" class="btn-del" onclick="inputValueDel()">입력 삭제</button>
                </div>
                <div class="input-box" style="flex: 1;">
                  <input type="text" class="input-txt" placeholder="하위요소설명" value="ORP 연구소와 지원분야에 지원한 동기가 분명하게 작성되어 있다" oninput="inputValueChk()">
                  <button type="button" class="btn-del" onclick="inputValueDel()">입력 삭제</button>
                </div>
              </div>
              <div class="form-inner">
                <button type="button" class="btn-item--add" onclick="rowItemAdd();">
                  <span>추가하기</span>
                </button>
              </div>
            </div>
          </div>   
          <div class="form-row__flex">
            <div class="form-th" style="width: 240px;">면접과제</div>
            <div class="form-td" style="flex: 1;">
              <div class="form-inner">
                <button type="button" class="base-btn type2__size-s">
                  <span class="base-icon icon-upload__size-s__color1" onclick="document.getElementById('uploadFile${index}').click();">파일업로드</span>
                </button>
                <input type="file" id="uploadFile${index}" class="is-hidden" title="파일업로드" onchange="addFileName(this)">
              </div>
              <div class="form-inner">
                <div class="tag__box"></div>
              </div>
            </div>
          </div>            
        </div>
      </div>
    `;
    
    section1ContWrap.insertAdjacentHTML('beforeend', template); // 마지막에 새로운 섹션 추가
  }

  // 질문지 추가
  function addSectionType2Cont() {
    const sectionType2 = document.querySelector('.section-type2');
    const section2ContWrap = document.querySelector('.section-type2 .section-cont-wrap');
    const index = document.querySelectorAll('.section-type2 .section-cont').length + 1; // 새로운 인덱스 계산

    // 평가요소 템플릿
    const template = `
      <div class="section-cont" data-index="${index}">
        <div class="d-flex jc-sb content-mt5">
          <h4 class="title-sub1">질문지${index}</h4>
          <div class="form-set__btn type-gap2">
            <button type="button" onclick="rowItemDown('.section-type2 .section-cont');">
              <span class="base-icon icon-down2__size-m__color3">
                <span class="isHidden">아래로</span>
              </span>
            </button>
            <button type="button" onclick="rowItemUp('.section-type2 .section-cont');">
              <span class="base-icon icon-up__size-m__color3">
                <span class="isHidden">위로</span>
              </span>
            </button>
            <button type="button" class="base-btn type-icon__color1" onclick="sectionItemDel('.section-type2 .section-cont');">
              <span class="base-icon icon-del__size-s__color3">
                <strong class="font-size-l">삭제</strong>
              </span>
            </button>
          </div>          
        </div>
        
        <div class="box-type1">
          <div class="form-row__flex">
            <div class="form-th" style="width: 240px;">질문주제</div>
            <div class="form-td" style="flex: 1;">
              <div class="form-inner">
                <div class="input-box h-full">
                  <input type="text" class="input-txt" oninput="inputValueChk()" value="지원동기">
                  <button type="button" class="btn-del" onclick="inputValueDel()">입력 삭제</button>
                </div>
              </div>
            </div>
          </div>            
          <div class="form-row__flex">
            <div class="form-th" style="width: 240px;">주질문</div>
            <div class="form-td" style="flex: 1;">
              <div class="form-inner">
                <button type="button" class="btn-item--del" onclick="rowItemDel();">
                  <span>삭제</span>
                </button>
                <div class="input-box" style="width: 200px;">
                  <input type="text" class="input-txt" placeholder="주질문 입력" oninput="inputValueChk()">
                  <button type="button" class="btn-del" onclick="inputValueDel()">입력 삭제</button>
                </div>
                <div class="input-box" style="flex: 1;">
                  <input type="text" class="input-txt" placeholder="주질문 설명 입력" oninput="inputValueChk()">
                  <button type="button" class="btn-del" onclick="inputValueDel()">입력 삭제</button>
                </div>
              </div>
              <div class="form-inner">
                <button type="button" class="btn-item--add" onclick="rowItemAdd(14);">
                  <span>추가하기</span>
                </button>
              </div>
            </div>
          </div>   
          <div class="form-row__flex">
            <div class="form-th" style="width: 240px;">추가질문</div>
            <div class="form-td" style="flex: 1;">
              <div class="form-inner">
                <button type="button" class="btn-item--del" onclick="rowItemDel();">
                  <span>삭제</span>
                </button>
                <div class="input-box" style="width: 200px;">
                  <input type="text" class="input-txt" placeholder="추가질문 입력" oninput="inputValueChk()">
                  <button type="button" class="btn-del" onclick="inputValueDel()">입력 삭제</button>
                </div>
                <div class="input-box" style="flex: 1;">
                  <input type="text" class="input-txt" placeholder="추가질문 설명 입력" oninput="inputValueChk()">
                  <button type="button" class="btn-del" onclick="inputValueDel()">입력 삭제</button>
                </div>
              </div>
              <div class="form-inner">
                <button type="button" class="btn-item--add" onclick="rowItemAdd(15);">
                  <span>추가질문 추가</span>
                </button>
              </div>
            </div>
          </div>   
        </div>
      </div>
    `;
    
    section2ContWrap.insertAdjacentHTML('beforeend', template); // 마지막에 새로운 섹션 추가
  }

  // 아이템 삭제
  function sectionItemDel(element) {
    // 이벤트가 발생한 요소를 기준으로 .section-cont 클래스를 가진 부모 요소를 찾습니다.
    let sectionCont = event.target.closest(element);

    // .section-cont 요소가 존재하면 해당 요소를 DOM에서 제거합니다.
    if (sectionCont) {
      sectionCont.remove();
      updateSectionIndexes(element); // 섹션 인덱스 업데이트 함수 호출
    }
  }  

  // 인덱스 체크
  function updateSectionIndexes(element) {
  // 모든 .section-cont 요소를 선택
  const allSections = document.querySelectorAll(element);

  // 각 섹션의 data-index 속성을 업데이트
  allSections.forEach((section, index) => {
    section.setAttribute('data-index', index + 1); // 인덱스를 1부터 시작하도록 설정

    if(element == '.section-type1 .section-cont') {
      section.querySelector(element + ' .title-sub1').textContent = `평가요소${index + 1}`; // 제목도 업데이트
    } else {
      section.querySelector(element + ' .title-sub1').textContent = `질문지${index + 1}`; // 제목도 업데이트
    }
  });
}
</script>
</body>
</html>